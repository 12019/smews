<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
    
<head>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript">
        var start = 0;
        var end = 0;
        var binfile = '';
        
        function TestDownload() {
            start = new Date().getTime();
            
            $.ajax({
                type: "GET",
                url: "datagen?size=10000",
                dataType: 'application/octet-stream',
                success: function(msg) {
                    binfile = msg;
                    end = new Date().getTime();
                    diff = (end - start) / 1000;
                    bytes = msg.length;
                    speed = (bytes / diff) / 1024 / 1024 * 8;
                    speed = Math.round(speed*100)/100;
                    $('#dlspeed').html('<b>' + speed + ' Mb/s (You)</b>');
                    $('#dlbar').css('width', Math.floor(speed * 30)+'px');
                },
                complete: function(xhr, textStatus) {
                }
            });
        }
        
        $(document).ready(function() {
            TestDownload();
        });
    </script>
</head>     

<body>
    <p>
        Download speed:<br>
        <img id="dlbar" src="bar.gif" style="width: 1px; height: 10px;"> <span id="dlspeed"><img src="busy.gif"></span><br>
        <img src="bar.gif" width="300" height="10"> 10 Mb/s
    </p>
</body>

</html>
